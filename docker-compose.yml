services:
  xray:
    image: ghcr.io/xtls/xray-core:latest
    container_name: xray-vless
    restart: unless-stopped
    network_mode: host
    user: "0:0"
    volumes:
      - ./config:/etc/xray:ro
    environment:
      - TZ=Europe/Paris
    cap_add:
      - NET_ADMIN
      - NET_BIND_SERVICE
    security_opt:
      - no-new-privileges:false
    command: ["run", "-c", "/etc/xray/config.json"]

  wireguard:
    image: linuxserver/wireguard:latest
    container_name: wireguard-vpn
    restart: unless-stopped
    ports:
      - "${WG_PORT:-51820}:51820/udp"
    environment:
      - PUID=0
      - PGID=0
      - TZ=Europe/Paris
      - SERVERURL=auto
      - SERVERPORT=${WG_PORT:-51820}
      - PEERS=1
      - PEERDNS=1.1.1.1
      - INTERNAL_SUBNET=10.66.66.0/24
    volumes:
      - ./config/wireguard:/config
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    sysctls:
      - net.ipv4.ip_forward=1
      - net.ipv4.conf.all.src_valid_mark=1

  openvpn:
    image: kylemanna/openvpn:latest
    container_name: openvpn-vpn
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
    ports:
      - "1194:1194/udp"
    volumes:
      - ./config/openvpn:/etc/openvpn
    environment:
      - OVPN_SERVER_URL=auto
    command: ovpn_run

